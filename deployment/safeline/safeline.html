<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title 0="D" 1="e" 2="v" 3="e" 4="l" 5="o" 6="p" 7="m" 8="e" 9="n" 10="t" 11=" " 12="D" 13="o" 14="c" 15="u" 16="m" 17="e" 18="n" 19="t" 20="a" 21="t" 22="i" 23="o" 24="n"></title><meta name="description" content="">
    <link rel="preload" href="/CS35-document/assets/style-Cm4hoC9H.css" as="style"><link rel="stylesheet" href="/CS35-document/assets/style-Cm4hoC9H.css">
    <link rel="modulepreload" href="/CS35-document/assets/app-BaRke6oO.js"><link rel="modulepreload" href="/CS35-document/assets/safeline.html-X-hNZDSu.js">
    <link rel="prefetch" href="/CS35-document/assets/index.html-CWxYGhVn.js" as="script"><link rel="prefetch" href="/CS35-document/assets/azure.html-D92mpFtG.js" as="script"><link rel="prefetch" href="/CS35-document/assets/testing.html-tiu_dA6v.js" as="script"><link rel="prefetch" href="/CS35-document/assets/stripe-setup.html-3lz-3WGI.js" as="script"><link rel="prefetch" href="/CS35-document/assets/front-end.html-DBzZsQBg.js" as="script"><link rel="prefetch" href="/CS35-document/assets/404.html-B-9hSehm.js" as="script"><link rel="prefetch" href="/CS35-document/assets/setupDevtools-7MC2TMWH-DlminZ4l.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/CS35-document/"><img class="vp-site-logo" src="/CS35-document/favicon.png" alt="Open_WebUI with Stripe Integration"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Open_WebUI with Stripe Integration</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/CS35-document/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.sydney.edu.au/CS35-1/CS35-1" aria-label="Source" rel="noopener noreferrer" target="_blank"><!---->Source<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/CS35-document/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.sydney.edu.au/CS35-1/CS35-1" aria-label="Source" rel="noopener noreferrer" target="_blank"><!---->Source<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Development <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/CS35-document/development/frontend/front-end.html" aria-label="Frontend development"><!---->Frontend development<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Payment Integration (Stripe) <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/CS35-document/stripe/stripe-setup/stripe-setup.html" aria-label="Stripe setup instructions"><!---->Stripe setup instructions<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/CS35-document/testing/testing.html" aria-label="Testing"><!---->Testing<!----></a><!----></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Deployment <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/CS35-document/deployment/azure/azure.html" aria-label="Azure"><!---->Azure<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/CS35-document/deployment/safeline/safeline.html" aria-label="Safeline"><!---->Safeline<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h3 id="_1-safeline-introduction" tabindex="-1"><a class="header-anchor" href="#_1-safeline-introduction"><span>1. Safeline Introduction</span></a></h3><p>Safeline is an open-source, web security solution developed to provide enhanced security for web applications and services. It operates as a Web Application Firewall (WAF), helping to protect applications from common threats like SQL injection, cross-site scripting (XSS), and DDoS attacks. By analyzing incoming and outgoing traffic, Safeline can <strong>detect and block malicious</strong> activity in real-time, preventing potential vulnerabilities from being exploited.</p><img src="/CS35-document/assets/slwork-vFzddQhJ.png" style="zoom:20%;"><h3 id="_2-configure-application-gateway-for-app-service" tabindex="-1"><a class="header-anchor" href="#_2-configure-application-gateway-for-app-service"><span>2. <strong>Configure Application Gateway for App Service</strong></span></a></h3><p>Before setting up Safeline, it&#39;s necessary to first configure an <strong>Application Gateway</strong> for the Azure App Service. This is required because the App Service uses a virtual IP address, which Safeline cannot directly use for traffic forwarding. The Application Gateway provides a public IP address that serves as a stable endpoint for external access. Safeline can then route traffic through this public IP, allowing it to securely act as a reverse proxy for the App Service.</p><ol><li><p><strong>Navigate to the Azure Portal</strong> and select <strong>Create a resource</strong>.</p></li><li><p>Choose <strong>Networking</strong> &gt; <strong>Application Gateway</strong> and configure the gateway settings.</p></li></ol><p><img src="/CS35-document/assets/appgateway-PDPWOT1l.png" alt=""></p><ol start="3"><li>Configure the basic information like resource group, region and application gateway name. Besides, you need to add a new subnet in the virtual network and apply it on application gateway. And remember to apply <strong>Microsoft.Web</strong> to your subnet in the service endpoint part of your virtual network.</li></ol><img src="/CS35-document/assets/appgateway1-CMQi1DEX.png" style="zoom:70%;"><img src="/CS35-document/assets/serviceend-DYhvf5h6.png" style="zoom:80%;"><ol start="4"><li>In the <strong>Frontend IP configuration</strong> section, create and assign a <strong>Public IP</strong> address to the Application Gateway. This IP address will act as the primary endpoint for all incoming traffic. Safeline will use this public IP to securely forward external requests, ensuring that any traffic directed at this IP address is routed through the gateway.</li></ol><p><img src="/CS35-document/assets/gatewayfront-CT_4zfvk.png" alt=""></p><ol start="5"><li>In the <strong>Backend pool</strong> settings, link your App Service as the backend target for the Application Gateway. Select <strong>Add a backend pool</strong>, then specify your App Service using its Fully Qualified Domain Name (FQDN) or by using IP-based settings, depending on your App Service configuration. Once all configurations are complete, deploy the Application Gateway. From this point forward, it will act as a secure and reliable entry point, managing and forwarding traffic heading to your App Service. You need to configure the frontend listener and backend targets.</li></ol><img src="/CS35-document/assets/gatewaybackendpool-C7cI-Y_N.png" style="zoom:100%;"><img src="/CS35-document/assets/routing%20rule1-BTiEmrri.png" style="zoom:80%;"><p>Configure the backend targets by choosing your app service as the backend source. What&#39;s more, you should also add bakcend settings whick includes choosing proper backend protocol HTTPS and the certificate is issued by well-known CA. Besides, <strong>choosing override with hostname and pick host name from backend target</strong> which will ensure the routing rule between listener and backend pool is well connected.</p><img src="/CS35-document/assets/backendsetting1-D1IInzG7.png" style="zoom:80%;"><img src="/CS35-document/assets/backendsetting2-Bqm0ZdxL.png" style="zoom:75%;"><ol start="6"><li><p>Once deployed, this Application Gateway will serve as a secure entry point for traffic heading to the App Service. use the <strong>frontend public ip</strong> address to have a try whether the deployment of gateway is successful or not. Safeline will use the public IP address provided by the gateway to securely forward requests, ensuring that traffic is correctly routed to the App Service.</p><img src="/CS35-document/assets/gatewaydeploy-B9sCoFKV.png" style="zoom:80%;"></li><li><p>To ensure that traffic only flows through the Application Gateway, configure the <strong>Access Restriction</strong> settings in your App Service to allow access only from the Virtual Network of your application gateway.</p><img src="/CS35-document/assets/appres-BCJO7cyK.png" style="zoom:70%;"></li></ol><h3 id="_3-install-safeline-on-a-virtual-machine" tabindex="-1"><a class="header-anchor" href="#_3-install-safeline-on-a-virtual-machine"><span>3. <strong>Install Safeline on a Virtual Machine</strong></span></a></h3><ol><li><p><strong>Provision a Virtual Machine</strong> on Azure or another cloud provider to host Safeline.</p><p><img src="/CS35-document/assets/vm-CzDYRD_q.png" alt=""></p></li><li><p>Fill out the following basic settings including <strong>Subscription</strong>, <strong>Resource Group</strong>, <strong>Virtual Machine Name</strong>, <strong>Region</strong>, <strong>Image(Ubuntu 22.04)</strong>, <strong>Size(2 cpu and 4 GB memory)</strong> and choose the authentication method (username and password) for accessing the VM.</p><img src="/CS35-document/assets/vmbasic-D6zIzLZj.png" style="zoom:77%;"></li><li><p>Once deployed the virtual machine, you will get the public ip address. <strong>SSH into the VM</strong> after setup, choose a proper ssh tool like Xshell and login in the virtual machine using the public ip, username and password.</p><img src="/CS35-document/assets/xshell-CLCq4rpZ.png" style="zoom:80%;"></li><li><p>Once installed, configure the firewall and network settings according to Safeline’s instructions to ensure secure communication between your Application Gateway and Safeline. Open the necessary ports, such as <strong>80</strong>, <strong>443</strong>, and <strong>9443</strong>, to allow seamless access for <strong>HTTP</strong>, <strong>HTTPS</strong>, and <strong>Safeline services</strong>.</p><p><img src="/CS35-document/assets/enableport-CllhFYPi.png" alt=""></p></li><li><p>Then <strong>download and install Safeline</strong> by following the [Safeline installation guide on their official website](<a href="https://github.com/chaitin/SafeLine" target="_blank" rel="noopener noreferrer">GitHub - chaitin/SafeLine: serve as a reverse proxy to protect your web services from attacks and exploits.</a>). Use the following command to start the automated installation of SafeLine. (This process requires root privileges)</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">bash -c &quot;$(curl -fsSLk https://waf.chaitin.com/release/latest/setup.sh)&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>After the command is executed, it means the installation is successfully. And you will get the username and password after installation. Please go to website directly. Open the web console page <strong><code>https://&lt;safeline-ip&gt;:9443/</code></strong> in the browser, then you will see below.</p><img src="/CS35-document/assets/safelinelogin-BMWuxbiJ.png" style="zoom:50%;"></li><li><p>Enter the <strong>username and password</strong> in the previous step and you will successfully logged into SafeLine.</p><img src="/CS35-document/assets/safeline_dashboard-Ds0BAVsQ.png" style="zoom:27%;"></li></ol><h3 id="_4-configure-safeline-for-traffic-forwarding" tabindex="-1"><a class="header-anchor" href="#_4-configure-safeline-for-traffic-forwarding"><span>4. <strong>Configure Safeline for Traffic Forwarding</strong></span></a></h3><ol><li><p>Set up Safeline to forward traffic from the Application Gateway to your backend App Service. Log into the SafeLine Web Admin Console, go to the &quot;Site&quot; -&gt; &quot;Website&quot; page and click the &quot;Add Site&quot; button in the upper right corner.</p><p><img src="/CS35-document/assets/add-site-1-BSvbvfQZ.png" alt=""></p></li><li><p>In the Safeline configuration, specify the IP addresses and forwarding rules to ensure traffic is correctly routed.</p><p><strong>Domain</strong>: domain name of your original website, or hostname, or ip address, for example: <code>www.chaitin.com</code>, you can use * as a wildcard or enter your domain name after you purchase the domain.</p><p><strong>Port</strong>: port that SafeLine will listen, such as 80 or 443. (for <code>https</code> websites, please check the <code>SSL</code> option, and you may add the ssl option after you purchase the domain and ssl certifications)</p><p><strong>Upstream</strong>: real address of your original website which is the address of application gateway, through which SafeLine will forward traffic to it.</p><p><img src="/CS35-document/assets/add-site-2-D14Mrheu.png" alt=""></p></li><li><p>Configure a firewall on the <strong>Application Gateway</strong> and set up access restrictions on the <strong>App Service</strong> to ensure that traffic can only flow in from the Safeline server.</p></li></ol><img src="/CS35-document/assets/gatewayrule-CRvmjF6R.png" style="zoom:80%;"><ol start="4"><li><p>Now, your website is protected by SafeLine, let’s try tp attack it and see what happens.</p><p>If <a href="https://chaitin.com/" target="_blank" rel="noopener noreferrer">https://chaitin.com</a> is a website protected by SafeLine, here are some test cases for common attacks:</p><ul><li><strong>SQL Injection</strong>: <code>https://chaitin.com/?id=1+and+1=2+union+select+1</code></li><li><strong>XSS</strong>: <code>https://chaitin.com/?id=&lt;img+src=x+onerror=alert()&gt;</code></li><li><strong>Path Traversal</strong>: <code>https://chaitin.com/?id=../../../../etc/passwd</code></li></ul><p>Replace <code>chaitin.com</code> in the above cases with your website domain name and try to access it. You can now replace the domain name with your ip address of virtual machine.</p><p>If you see the following blocking page, it means SafeLine successfully helped you defense the attack.</p><img src="/CS35-document/assets/blocked-BUHetDs-.png" style="zoom:50%;"></li></ol><h3 id="_5-domain-configuration-and-tls-setup" tabindex="-1"><a class="header-anchor" href="#_5-domain-configuration-and-tls-setup"><span>5.Domain Configuration and TLS Setup</span></a></h3><ol><li>Purchase and Set Up a Domain in <strong>Domain.com</strong>:</li></ol><ul><li><p>If you haven’t already, purchase a domain from Domain.com, Godaddy, Crazy domain or other websites. Once you&#39;ve purchased a domain, log into your account and navigate to the <strong>DNS Management</strong> page.</p><img src="/CS35-document/assets/dns-B7h58pY8.png" style="zoom:170%;"></li><li><p>In DNS Management, configure an <strong>A record</strong> to point to the IP address of your Application Gateway. This links your domain to your application, enabling users to access it via the domain name.</p><p><img src="/CS35-document/assets/arecord-DwqGKsk4.png" alt=""></p></li><li><p>Changing DNS records requires some time to take effect. After a while, you can try accessing the website using your domain to check if the DNS records have propagated.</p></li></ul><ol start="2"><li>Install TLS Certificate Using ZeroSSL or other websites:</li></ol><ul><li><p>Go to <a href="https://zerossl.com/" target="_blank" rel="noopener noreferrer">ZeroSSL</a>, generate a TLS certificate, and download it along with the CA bundle.</p><img src="/CS35-document/assets/zerossl-tvOk5iqO.png" style="zoom:80%;"></li><li><p>In Safeline cert, add the certificate you just obtained from ZeroSSL. Remember to upload both <strong><code>certificate.crt</code>, <code>ca_bundle.crt</code></strong> in the SSL cert section. And you need to choose the ssl certificate you just uploaded on Web Services.</p><img src="/CS35-document/assets/safelinecert-NaUMOtln.png" style="zoom:80%;"></li></ul><ol start="3"><li>With these steps completed, Safeline should be ready to securely forward traffic from your configured domain to the App Service via the Application Gateway, protected by the <strong>TLS certificate</strong> from ZeroSSL.</li></ol><img src="/CS35-document/assets/end1-DWNYMd7f.png" style="zoom:60%;"><img src="/CS35-document/assets/end2-DyjEUjPo.png" style="zoom:60%;"></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: StevenFeng1020@outlook.com">StevenFeng</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 1276502818@qq.com">hyq-manu</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/CS35-document/deployment/azure/azure.html" aria-label="Azure"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Azure</span></div></a><!----></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/CS35-document/assets/app-BaRke6oO.js" defer></script>
  </body>
</html>
